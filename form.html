<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form FAQ - WOM Finance</title>
    <link rel="icon" href="wom-finance.jpg" type="image/png" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <!-- SweetAlert CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.2/dist/sweetalert2.min.css"
      rel="stylesheet"
    />
    <style>
      .input-wrapper {
        display: flex;
      }
      .input-wrapper input {
        padding: 0.5rem;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      .input-wrapper input[disabled] {
        background-color: #f3f3f3;
        border-right: none;
      }
      .input-wrapper .number-input {
        border-left: none;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container py-3">
      <h1 class="mb-4 text-center">Form FAQ - WOM Finance</h1>
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0 small">Isi Form FAQ</h5>
        </div>
        <div class="card-body">
          <form id="faqForm" method="POST" novalidate>
            <!-- Brand and Error Sistem -->
            <div class="row mb-2">
              <div class="col-md-6">
                <label for="brand" class="form-label small text-muted"
                  >Brand</label
                >
                <select id="brand" class="form-select form-select-sm" required>
                  <option value="">-- Pilih Brand --</option>
                  <option value="nb">Reguler</option>
                  <option value="mas">MasKu</option>
                  <option value="mtr">MotorKu</option>
                  <option value="mbl">MobilKu</option>
                </select>
                <div class="invalid-feedback">Brand harus dipilih!</div>
              </div>
              <div class="col-md-6">
                <label for="errorSystem" class="form-label small text-muted"
                  >Error Sistem</label
                >
                <select
                  id="errorSystem"
                  name="entry.349701399"
                  class="form-select form-select-sm"
                >
                  <option value="">-- Pilih Error Sistem --</option>
                  <option value="ki">KI</option>
                  <option value="mss">MSS</option>
                  <option value="wise">WISE</option>
                  <option value="login">Login</option>
                </select>
              </div>
            </div>

            <!-- Region and Cabang -->
            <div class="row mb-2">
              <div class="col-md-6">
                <label for="region" class="form-label small text-muted"
                  >Region</label
                >
                <select
                  id="region"
                  name="entry.443996126"
                  class="form-select form-select-sm"
                >
                  <option value="">-- Pilih Region --</option>
                  <!-- Region options will be added dynamically -->
                </select>
              </div>
              <div class="col-md-6">
                <label for="cabang" class="form-label small text-muted"
                  >Cabang</label
                >
                <select
                  id="cabang"
                  name="entry.27483305"
                  class="form-select form-select-sm"
                >
                  <option value="">-- Pilih Cabang --</option>
                  <!-- Cabang options will be added dynamically -->
                </select>
              </div>
            </div>

            <!-- Nama Cust and Cust ID -->
            <div class="row mb-2">
              <div class="col-md-6">
                <label for="NCust" class="form-label small text-muted"
                  >Nama Cust</label
                >
                <input
                  type="text"
                  id="NCust"
                  name="entry.1285711467"
                  class="form-control form-control-sm"
                />
              </div>
              <div class="col-md-6">
                <label for="IdCust" class="form-label small text-muted"
                  >Cust ID</label
                >
                <input
                  type="text"
                  id="IdCust"
                  name="entry.1383050238"
                  class="form-control form-control-sm"
                />
              </div>
            </div>

            <!-- PIC Input and No Kawan -->
            <div class="row mb-2">
              <div class="col-md-6">
                <label for="pic" class="form-label small text-muted"
                  >PIC Input</label
                >
                <input
                  type="text"
                  id="pic"
                  name="entry.1372652565"
                  class="form-control form-control-sm"
                  required
                />
                <div class="invalid-feedback">PIC harus diisi!</div>
              </div>
              <div class="col-md-6">
                <label for="NoKwn" class="form-label small text-muted"
                  >No Kawan Internal</label
                >
                <div class="input-wrapper">
                  <input
                    type="text"
                    id="noKwnPrefix"
                    value="KWNI"
                    disabled
                    style="width: 75px"
                  />
                  <input
                    type="text"
                    id="NoKwn"
                    name="entry.163739172"
                    class="form-control form-control-sm"
                    required
                  />
                </div>
                <div class="invalid-feedback">No Kawan harus diisi!</div>
              </div>
            </div>

            <!-- Task ID Polo and No App -->
            <div class="row mb-2">
              <div class="col-md-6">
                <label for="IdPolo" class="form-label small text-muted"
                  >Task ID Polo</label
                >
                <div class="input-wrapper">
                  <input
                    type="text"
                    id="taskIdPoloPrefix"
                    value="POL"
                    disabled
                    style="width: 75px"
                  />
                  <input
                    type="text"
                    id="IdPolo"
                    name="entry.163739172"
                    class="form-control form-control-sm"
                  />
                </div>
                <div class="invalid-feedback">Task ID Polo harus diisi!</div>
              </div>
              <div class="col-md-6">
                <label for="NoApp" class="form-label small text-muted"
                  >No APP</label
                >
                <div class="input-wrapper">
                  <input
                    type="text"
                    id="noAppPrefix"
                    value="APP"
                    disabled
                    style="width: 75px"
                  />
                  <input
                    type="text"
                    id="NoApp"
                    name="entry.66506618"
                    class="form-control form-control-sm"
                  />
                </div>
                <div class="invalid-feedback">No APP harus diisi!</div>
              </div>
            </div>

            <!-- No Odrn -->
            <div class="row mb-2">
              <div class="col-md-12">
                <label for="NoOdrn" class="form-label small text-muted"
                  >No Odrn</label
                >
                <div class="input-wrapper">
                  <input
                    type="text"
                    id="noOdrPrefix"
                    value="ODRNO"
                    disabled
                    style="width: 75px"
                  />
                  <input
                    type="text"
                    id="NoOdrn"
                    name="entry.996527903"
                    class="form-control form-control-sm"
                  />
                </div>
                <div class="invalid-feedback">No Odrn harus diisi!</div>
              </div>
            </div>

            <!-- Issue -->
            <div class="mb-2">
              <label for="issue" class="form-label small text-muted"
                >Issue</label
              >
              <textarea
                id="issue"
                name="entry.902491819"
                class="form-control form-control-sm"
                rows="5"
                required
              ></textarea>
              <div class="invalid-feedback">Issue harus diisi!</div>
            </div>

            <!-- Buttons -->
            <div class="mb-2">
              <button
                type="submit"
                id="submitButton"
                class="btn btn-primary btn-sm"
              >
                Submit
              </button>
              <button
                type="button"
                class="btn btn-secondary btn-sm"
                onclick="window.location.reload()"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.2/dist/sweetalert2.all.min.js"></script>
    <script>
      // Fungsi untuk memuat dropdown Region dan Cabang
      function loadRegionData() {
        fetch("region.json") // Pastikan path JSON sesuai dengan lokasi file Anda
          .then((response) => response.json())
          .then((data) => {
            // Dapatkan elemen select untuk region dan cabang
            const regionSelect = document.getElementById("region");
            const cabangSelect = document.getElementById("cabang");

            // Clear existing options
            regionSelect.innerHTML =
              '<option value="">-- Pilih Region --</option>';
            cabangSelect.innerHTML =
              '<option value="">-- Pilih Cabang --</option>';

            // Menambahkan option untuk region
            const regions = [...new Set(data.map((item) => item.REGION_NAME))]; // Mengambil region yang unik
            regions.forEach((region) => {
              const option = document.createElement("option");
              option.value = region;
              option.textContent = region;
              regionSelect.appendChild(option);
            });

            // Menambahkan event listener untuk mengubah cabang saat region dipilih
            regionSelect.addEventListener("change", function () {
              const selectedRegion = regionSelect.value;
              if (selectedRegion) {
                // Menampilkan cabang berdasarkan region yang dipilih
                const filteredCabangs = data.filter(
                  (item) => item.REGION_NAME === selectedRegion
                );
                cabangSelect.innerHTML =
                  '<option value="">-- Pilih Cabang --</option>'; // Clear existing options
                filteredCabangs.forEach((item) => {
                  const option = document.createElement("option");
                  option.value = item.COMP_OFFICE_NAME;
                  option.textContent = item.COMP_OFFICE_NAME;
                  cabangSelect.appendChild(option);
                });
              }
            });
          })
          .catch((error) => {
            console.error("Error fetching region data:", error);
          });
      }

      // Mapping untuk masing-masing kategori
      const formEntries = {
        reguler: {
          region: "entry.1598700675",
          cabang: "entry.1186697341",
          errorSystem: "entry.548595678",
          namaCust: "entry.640976597",
          custId: "entry.1765799161",
          picInput: "entry.1966416914",
          noKwn: "entry.506741088",
          taskIdPolo: "entry.348392057",
          noApp: "entry.366397148",
          noOdr: "entry.740554294",
          issue: "entry.880078936",
        },
        motorku: {
          region: "entry.1598700675",
          cabang: "entry.1186697341",
          errorSystem: "entry.548595678",
          namaCust: "entry.640976597",
          custId: "entry.1765799161",
          picInput: "entry.1966416914",
          noKwn: "entry.506741088",
          taskIdPolo: "entry.348392057",
          noApp: "entry.366397148",
          noOdr: "entry.740554294",
          issue: "entry.880078936",
        },
        masku: {
          region: "entry.1598700675",
          cabang: "entry.1186697341",
          errorSystem: "entry.548595678",
          namaCust: "entry.640976597",
          custId: "entry.1765799161",
          picInput: "entry.1966416914",
          noKwn: "entry.506741088",
          taskIdPolo: "entry.348392057",
          noApp: "entry.366397148",
          noOdr: "entry.740554294",
          issue: "entry.880078936",
        },
        mobilku: {
          region: "entry.1598700675",
          cabang: "entry.1186697341",
          errorSystem: "entry.548595678",
          namaCust: "entry.640976597",
          custId: "entry.1765799161",
          picInput: "entry.1966416914",
          noKwn: "entry.506741088",
          taskIdPolo: "entry.348392057",
          noApp: "entry.366397148",
          noOdr: "entry.740554294",
          issue: "entry.880078936",
        },
      };

      // Fungsi untuk memperbarui input form berdasarkan kategori
      function updateFormFields(brand) {
        // Dapatkan mapping dari brand yang dipilih
        const fields = formEntries[brand.toLowerCase()];
        if (!fields) return;

        // Update setiap input berdasarkan mapping
        for (const [key, entry] of Object.entries(fields)) {
          const input = document.getElementById(key);
          if (input) {
            input.name = entry; // Update atribut 'name' dengan 'entry' yang sesuai
          }
        }
      }

      // Fungsi untuk validasi dan set required fields
      function updateRequiredFields(errorSystem) {
        // Hapus tanda '*' dari semua label sebelum menambahkan yang baru
        const labels = document.querySelectorAll("label");
        labels.forEach((label) => {
          const star = label.querySelector(".text-danger");
          if (star) {
            star.remove();
          }
        });

        // Menambahkan tanda '*' sesuai dengan pilihan errorSystem
        if (errorSystem === "ki") {
          document.querySelector('label[for="region"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="cabang"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="brand"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="NCust"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="pic"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="NoKwn"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="issue"]').innerHTML +=
            ' <span class="text-danger">*</span>';
        } else if (errorSystem === "mss") {
          document.querySelector('label[for="region"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="cabang"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="NCust"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="pic"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="NoOdrn"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="issue"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="IdPolo"]').innerHTML +=
            ' <span class="text-danger">*</span>';
        } else if (errorSystem === "wise") {
          document.querySelector('label[for="region"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="cabang"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="NCust"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="pic"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="NoApp"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="issue"]').innerHTML +=
            ' <span class="text-danger">*</span>';
        } else if (errorSystem === "login") {
          document.querySelector('label[for="region"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="cabang"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="pic"]').innerHTML +=
            ' <span class="text-danger">*</span>';
          document.querySelector('label[for="issue"]').innerHTML +=
            ' <span class="text-danger">*</span>';
        }
      }

      // Event listener untuk validasi saat form disubmit
      document
        .getElementById("faqForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          // Ambil nilai field dari form
          const errorSystem = document.getElementById("errorSystem").value;
          const region = document.getElementById("region").value;
          const cabang = document.getElementById("cabang").value;
          const NCust = document.getElementById("NCust").value;
          const pic = document.getElementById("pic").value;
          const NoKwn = document.getElementById("NoKwn").value;
          const NoOdrn = document.getElementById("NoOdrn").value;
          const NoApp = document.getElementById("NoApp").value;
          const issue = document.getElementById("issue").value;
          const IdPolo = document.getElementById("IdPolo").value;

          // Validasi berdasarkan error system
          let valid = true;
          let message = "";

          if (errorSystem === "ki") {
            if (!region || !cabang || !NCust || !pic || !NoKwn || !issue) {
              valid = false;
              message =
                "Harap lengkapi semua field yang wajib diisi untuk Error Sistem KI!";
            }
          } else if (errorSystem === "mss") {
            if (
              !region ||
              !cabang ||
              !NCust ||
              !pic ||
              !NoOdrn ||
              !issue ||
              !IdPolo
            ) {
              valid = false;
              message =
                "Harap lengkapi semua field yang wajib diisi untuk Error Sistem MSS!";
            }
          } else if (errorSystem === "wise") {
            if (!region || !cabang || !NCust || !pic || !NoApp || !issue) {
              valid = false;
              message =
                "Harap lengkapi semua field yang wajib diisi untuk Error Sistem WISE!";
            }
          } else if (errorSystem === "login") {
            if (!region || !cabang || !pic || !issue) {
              valid = false;
              message =
                "Harap lengkapi semua field yang wajib diisi untuk Error Sistem Login!";
            }
          } else {
            valid = false;
            message = "Pilih Error Sistem yang valid!";
          }

          if (!valid) {
            Swal.fire("Error", message, "error");
          } else {
            // Tentukan link Google Form berdasarkan Brand
            let googleFormLink = "";
            const brand = document.getElementById("brand").value;

            if (brand === "nb") {
              googleFormLink =
                "https://docs.google.com/forms/d/e/1FAIpQLSdHmxNG4txZSLBWaT9KbJ-WHBDCAaox9rrl0EmohPaulMIfuQ/formResponse";
            } else if (brand === "mas") {
              googleFormLink =
                "https://docs.google.com/forms/d/e/1FAIpQLSft47A_gfLSo0LUzvgmpmqLLQjcW8MXnyXLaW9FVJwM90C-oQ/formResponse";
            } else if (brand === "mtr") {
              googleFormLink =
                "https://docs.google.com/forms/d/e/1FAIpQLSdJZENA-ZzzJOoEigT-NS6ofOhW_JJV-pRbX1dKuweCQq7hgA/formResponse";
            } else if (brand === "mbl") {
              googleFormLink =
                "https://docs.google.com/forms/d/e/1FAIpQLSdkNu25qy4Rp0hM_e43fLlcJeFEiG7wgqsI7GbyEhNE-Y7Q0Q/formResponse";
            } else {
              valid = false;
              message = "Pilih brand yang valid!";
            }

            if (valid) {
              // window.location.href = googleFormLink;
              // Konfirmasi pengiriman
              const form = document.getElementById("faqForm");
              form.action = googleFormLink;
              form.method = "POST";
              form.submit();

              // Menunggu hingga pengiriman selesai
              setTimeout(function () {
                // Simulasi pengiriman sukses atau gagal
                const success = true; // Setel ke false untuk gagal

                if (success) {
                  Swal.fire(
                    "Berhasil!",
                    "Formulir berhasil dikirim.",
                    "success"
                  );
                } else {
                  Swal.fire("Gagal!", "Pengiriman formulir gagal.", "error");
                }
              }, 2000); // Waktu tunggu untuk simulasi
            }
          }
        });

      // Load region data saat halaman dimuat
      document.addEventListener("DOMContentLoaded", function () {
        loadRegionData();
      });

      // Event listener untuk dropdown error system
      document
        .getElementById("errorSystem")
        .addEventListener("change", function () {
          const errorSystem = this.value;
          updateRequiredFields(errorSystem); // Panggil fungsi dengan parameter yang sesuai
        });

      // Event listener untuk perubahan pada dropdown 'brand'
      document.getElementById("brand").addEventListener("change", function () {
        const selectedBrand = this.value; // Dapatkan nilai brand yang dipilih
        updateFormFields(selectedBrand);
      });

      // Tambahkan event listener untuk menambahkan prefix ke input yang sesuai
      function addPrefixes() {
        const odrInput = document.getElementById("NoOdrn");
        const kwnInput = document.getElementById("NoKwn");
        const poloInput = document.getElementById("IdPolo");
        const appInput = document.getElementById("NoApp");

        // Fungsi untuk menambahkan prefix jika belum ada
        const addPrefix = (input, prefix) => {
          if (input && input.value && !input.value.startsWith(prefix)) {
            input.value = prefix + input.value;
          }
        };

        // Event listener untuk setiap input
        odrInput?.addEventListener("blur", () => addPrefix(odrInput, "ODRNO"));
        kwnInput?.addEventListener("blur", () => addPrefix(kwnInput, "KWNI"));
        poloInput?.addEventListener("blur", () => addPrefix(poloInput, "POL"));
        appInput?.addEventListener("blur", () => addPrefix(appInput, "APP"));
      }

      // Jalankan fungsi saat DOM selesai dimuat
      document.addEventListener("DOMContentLoaded", addPrefixes);
    </script>
  </body>
</html>
